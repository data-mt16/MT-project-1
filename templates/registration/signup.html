{% extends 'base.html' %}

{% block content %}
<h2>Sign Up</h2>
<form method="post">
  {% csrf_token %}
  
  {% if form.errors %}
    <div class="alert alert-danger">
        <p><strong>Please correct the errors below:</strong></p>
        {{ form.errors }}
    </div>
  {% endif %}

  <div class="mb-3">
      <label for="{{ form.username.id_for_label }}" class="form-label">Username</label>
      {{ form.username }}
  </div>

  <div class="mb-3">
      <label for="{{ form.password1.id_for_label }}" class="form-label">Password</label>
      {{ form.password1 }}
      <div id="password-feedback" class="form-text">Enter a password that meets the requirements below.</div>
  </div>

  <div class="mb-3">
      <label for="{{ form.password2.id_for_label }}" class="form-label">Password confirmation</label>
      {{ form.password2 }}
      <div id="confirmation-feedback" class="form-text"></div>
  </div>
  
  <button type="submit" class="btn btn-primary">Sign Up</button>
</form>
{% endblock %}

{% block scripts %}
<script>
    // --- Get all the elements we need ---
    const passwordInput = document.getElementById('id_password1');
    const passwordConfirmInput = document.getElementById('id_password2');
    const passwordFeedback = document.getElementById('password-feedback');
    const confirmationFeedback = document.getElementById('confirmation-feedback');

    // --- Function to check password strength ---
    function validatePasswordStrength() {
        const password = passwordInput.value;
        let errors = [];

        if (password.length < 8) {
            errors.push("Must be at least 8 characters long.");
        }
        if (!/\d/.test(password)) {
            errors.push("Must contain at least one number.");
        }
        if (!/[A-Z]/.test(password)) {
            errors.push("Must contain at least one uppercase letter.");
        }

        if (errors.length > 0) {
            passwordFeedback.innerHTML = '<ul>' + errors.map(error => `<li>${error}</li>`).join('') + '</ul>';
            passwordFeedback.className = 'text-danger mt-2';
        } else {
            passwordFeedback.innerHTML = '<ul class="mb-0"><li>Password is strong!</li></ul>';
            passwordFeedback.className = 'text-success mt-2';
        }
    }

    // --- Function to check if passwords match ---
    function validatePasswordConfirmation() {
        const password = passwordInput.value;
        const confirmPassword = passwordConfirmInput.value;

        if (confirmPassword.length === 0) {
            confirmationFeedback.innerHTML = '';
            return;
        }

        if (password === confirmPassword) {
            confirmationFeedback.innerHTML = 'Passwords match!';
            confirmationFeedback.className = 'text-success mt-2';
        } else {
            confirmationFeedback.innerHTML = 'Passwords do not match!';
            confirmationFeedback.className = 'text-danger mt-2';
        }
    }

    // --- Add Event Listeners ---
    passwordInput.addEventListener('input', function() {
        validatePasswordStrength();
        validatePasswordConfirmation(); // Also check confirmation when the first password changes
    });
    
    passwordConfirmInput.addEventListener('input', validatePasswordConfirmation);

</script>
{% endblock %}