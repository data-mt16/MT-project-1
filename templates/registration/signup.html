{% extends 'base.html' %}

{% block content %}
<h2>Sign Up</h2>
<form method="post">
  {% csrf_token %}
  
  {% if form.non_field_errors %}
    <div class="alert alert-danger">
        {% for error in form.non_field_errors %}<p>{{ error }}</p>{% endfor %}
    </div>
  {% endif %}

  <div class="mb-3">
      <label for="{{ form.username.id_for_label }}" class="form-label">Username</label>
      {{ form.username }}
      {% if form.username.errors %}<div class="text-danger mt-1">{{ form.username.errors }}</div>{% endif %}
  </div>

  <div class="mb-3">
      <label for="{{ form.password1.id_for_label }}" class="form-label">Password</label>
      {{ form.password1 }}
      
      <div id="password-feedback" class="form-text"></div>
      
      {% if form.password1.errors %}<div class="text-danger mt-1">{{ form.password1.errors }}</div>{% endif %}
  </div>

  <div class="mb-3">
      <label for="{{ form.password2.id_for_label }}" class="form-label">Password confirmation</label>
      {{ form.password2 }}
      {% if form.password2.errors %}<div class="text-danger mt-1">{{ form.password2.errors }}</div>{% endif %}
  </div>
  
  <button type="submit" class="btn btn-primary">Sign Up</button>
</form>
{% endblock %}


{% block scripts %}
<script>
    // Get the elements we need to work with
    const passwordInput = document.getElementById('id_password1');
    const passwordFeedback = document.getElementById('password-feedback');

    // Add an event listener that fires every time the user types in the password field
    passwordInput.addEventListener('input', function() {
        const password = this.value;
        let errors = [];

        // --- Our Validation Rules ---
        // Rule 1: Check for minimum length
        if (password.length < 8) {
            errors.push("Must be at least 8 characters long.");
        }
        // Rule 2: Check for a number
        if (!/\d/.test(password)) {
            errors.push("Must contain at least one number.");
        }
        // Rule 3: Check for an uppercase letter
        if (!/[A-Z]/.test(password)) {
            errors.push("Must contain at least one uppercase letter.");
        }

        // --- Displaying the Feedback ---
        if (errors.length > 0) {
            // If there are errors, show them in red
            passwordFeedback.innerHTML = errors.map(error => `<li>${error}</li>`).join('');
            passwordFeedback.className = 'text-danger mt-2';
        } else {
            // If there are no errors, show a success message in green
            passwordFeedback.innerHTML = '<li>Password is strong!</li>';
            passwordFeedback.className = 'text-success mt-2';
        }
    });
</script>
{% endblock %}
